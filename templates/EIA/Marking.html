<!DOCTYPE html >
{% load staticfiles %}
<html xmlns="http://www.w3.org/1999/html">
<script src="{% static 'EIA/js/jquery.min.js' %}"></script>
<link href="{% static 'EIA/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="{% static 'EIA/css/flat-ui.css' %}" rel="stylesheet">
  <script src="{% static 'EIA/js/flat-ui.min.js' %}"></script>
<head>
    <title id="title">
        {{ json|safe }}
    </title>
</head>
<body>
    <div id = "canvascontainer" width="1200px" height="700px">
        <form action="/updatepeople/" id = "markform" method="post">
            {% csrf_token %}
            <section><canvas id="canvas21" width="1200px" height="700px">
    <script type="text/javascript">
        jsonstring = '{{ json|safe }}';
        num = '{{ num|safe }}';
        document.getElementById("canvascontainer").oncontextmenu = function(e){
　　           return false;
};
        dataname = '{{ name|safe }}';
        var sc = 0;
        function drawbackground(id) {
            var canvas = document.getElementById(id);
            if (canvas == null)
                return false;
            var context = canvas.getContext("2d");
            img = new Image();
            img.src = "{{ imgurl|safe }}";
            img.onload = function(){
                alert(dataname);
                h = img.height;
                sc = 700/h;
                context.scale(sc,sc);
                context.drawImage(img,0,0);
                context.scale(1,1);
                for(var i=0;i<num;i++)//一维长度为人数
                for(var j=0;j<51;j++){
                        if((j+1)%3!=0)
                            arr[i][j] = arr[i][j] * sc;
               }
                update("canvasface");
            }
        }
        var obj = JSON.parse(jsonstring);
        arr = new Array();
            for(var i=0;i<num;i++){
               arr[i]=new Array();
               for(var j=0;j< 51;j++){
                        arr[i][j]=0.0;
               }
            }
            var i = 0;
            for(var o in obj){
                for(var j=0;j<obj[o].length;j++){
                        arr[i][j]=obj[o][j];
               }
               i++;
            }//初始化
        for(var i=0;i<num;i++){
                if(arr[i][16*3] == 0 && arr[i][11*3+2]!=3)
                {
                arr[i][16*3] = arr[i][11*3];
                arr[i][16*3+1] = arr[i][11*3+1];
                arr[i][16*3+2] = 1;
                }
                if(arr[i][15*3] == 0 && arr[i][8*3+2]!=3) {
                    arr[i][15 * 3] = arr[i][8 * 3];
                    arr[i][15 * 3 + 1] = arr[i][8 * 3 + 1];
                    arr[i][15 * 3 + 2] = 1;
                }
                if(arr[i][14*3] == 0 && arr[i][12*3+2]!=3) {
                    arr[i][14 * 3] = arr[i][12 * 3];
                    arr[i][14 * 3 + 1] = arr[i][12 * 3 + 1] + 20;
                    arr[i][14 * 3 + 2] = 1;
                }
        }

    </script>
    </canvas></section>
    <section><canvas id="canvasface" name="canvasface" width="1200px" height="775px"></canvas></section>
    </form>
        <button class="btn btn-block btn-lg btn-primary" id="submit_btn">标注完成</button>
    </div>
    <form action="/peopleleave/" id = "leaveform" method="post">
            {% csrf_token %}
        <input type="text" name = "dataname" id = "dataname" value="{{ name }}" style="display:none">
    </form>
    <style>
           #canvas21{
           z-index:1;
           position:absolute;left:0;top:0;
            }
           #canvasface{
           z-index:2;
           position:absolute;left:0;top:0;
            }
           #canvascontainer{
               margin:0 auto;
               width:1200px;
               position:relative;
           }
        #submit_btn{
            position:absolute;left:100px;top:775px;
        }
    </style>
<script src="{% static 'EIA/js/peoplemark.js' %}"></script>
</body>
</html>
